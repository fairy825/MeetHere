<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:include="include/admin/adminHeader::html('订单管理')" ></head>
<body>
<div th:replace="include/admin/adminNavigator::html" ></div>
<script>
    $(function(){

        var data4Vue = {
            uri:'bookings',
            beans: [],
            date:'',
            searchbean:{id:null,state:'',timeSlot:{'id':0,bookingDate:''},
                user:{'id':0,name:""},venue:{'id':0,name:""}},
            pagination:{},
            flag:0
        };

        //ViewModel
        var vue = new Vue({
            el: '#workingArea',
            data: data4Vue,
            mounted:function(){ //mounted　表示这个 Vue 对象加载成功了
                if(this.flag==0) this.list(0);
            },
            methods: {
                // list:function(start){
                //     var url =  this.uri+ "?start="+start;
                //     axios.get(url).then(function(response) {
                //         vue.pagination = response.data.data;
                //         vue.beans = response.data.data.content;
                //         vue.flag=0;
                //
                //         console.log(vue.beans);
                //     });
                // },
                list:function(start){
                    var url =  this.uri+ "?start="+start+"&date="+this.date;
                    console.log(this.searchbean);
                    console.log("DATE",this.date);

                    axios.post(url,this.searchbean).then(function(response) {
                        vue.pagination = response.data.data;
                        vue.beans = response.data.data.content;
                        // vue.date = '';
                        // vue.searchbean = {id:null, state:null,timeSlot:{'id':0,bookingDate:''},
                        //     user:{'id':0,name:""},venue:{'id':0,name:""}};
                        vue.flag = 1;
                        console.log(vue.beans);
                    });
                },
                jump: function(page){
                    jump(page,vue); //定义在adminHeader.html 中
                },
                jumpByNumber: function(start){
                    jumpByNumber(start,vue);
                },
                approve:function(id,e){
                    var url =  "approve/"+id;
                    axios.put(url).then(function(response) {
                        vue.list(0);
                    });
                },
                refuse:function(id,e){
                    var url =  "refuse/"+id;
                    axios.put(url).then(function(response) {
                        vue.list(0);
                    });
                }
            }
        });

        Vue.filter('formatDateFilter', function (value, formatString) {
            if(null==value)
                return "";
            formatString = formatString || 'YYYY-MM-DD HH:mm:ss';
            return moment(value).format(formatString);
        });
    });

</script>

<div id="workingArea" >
    <h1 class="label label-info" >订单管理</h1>

    <table>
        <div class="searchDiv">
            <input type="text"
                   @keyup.enter="list(0)" v-model.trim="searchbean.user.name" placeholder="请输入用户名" />
            <input type="text"
                   @keyup.enter="list(0)" v-model.trim="searchbean.venue.name" placeholder="请输入场馆名" />
            <div class="dropdown">
                <select v-model="searchbean.state">
                    <option value="">请选择状态</option>
                    <option value="waitApprove">待审核</option>
                    <option value="refused">驳回</option>
                    <option value="waitPay">待付款</option>
                    <option value="waitTime">未到预约时间</option>
                    <option value="waitArrive">待到达</option>
                    <option value="waitFinish">进行中</option>
                    <option value="waitReview">可留言</option>
                    <option value="finish">已结束</option>
                </select>
            </div>

            <div class="dropdown">
                <select v-model="date">
                    <option value="">请选择日期</option>
                    <option value="0">今天</option>
                    <option value="1">明天</option>
                    <option value="2">后天</option>
                </select>
            </div>
            <button @click="list(0)" class="searchButton">搜索</button>
        </div>
    </table>
    <br>
    <br>

    <div class="listDataTableDiv">
        <table class="table table-striped table-bordered table-hover  table-condensed">
            <thead>
            <tr class="success">
                <th>用户名</th>
                <th>昵称</th>
                <th>场馆编号</th>
                <th>场馆名称</th>
                <th>创建时间</th>
                <th>支付时间</th>
                <th>到达时间</th>
                <th>预约日期</th>
                <th>预约起始时间</th>
                <th>预约终止时间</th>
                <th>订单状态</th>
                <th>操作</th>
            </tr>
            </thead>
            <tbody>
                <tr v-for="bean in beans ">
                    <td>{{bean.user.name}}</td>
                    <td>{{bean.user.nickname}}</td>
                    <td>{{bean.venue.id}}</td>
                    <td>{{bean.venue.name}}</td>

                    <td>
                        {{bean.createDate}}
                    </td>
                    <td>
                        {{bean.payDate}}
                    </td>
                    <td>
                        {{bean.arriveDate}}
                    </td>
                    <td>
                        {{bean.timeSlot.bookingDate}}
                    </td>
                    <td>
                        {{bean.timeSlot.beginTime}}:00
                    </td>
                    <td>
                        {{bean.timeSlot.endTime}}:00
                    </td>
                    <td>
                        {{bean.stateDesc}}
                    </td>
                    <td>
                        <button v-if="bean.state=='waitApprove'" @click="approve(bean.id,$event)" class="btn btn-primary btn-xs">同意</button>
                        <button v-if="bean.state=='waitApprove'" @click="refuse(bean.id,$event)" class="btn btn-primary btn-xs">驳回</button>
                    </td>
                </tr>

            </tbody>
        </table>
    </div>

    <div th:replace="include/admin/adminPage::html" ></div>


</div>

<div th:replace="include/admin/adminFooter::html" ></div>
</body>
</html>
