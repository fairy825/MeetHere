<!-- 模仿天猫整站springboot 教程 为how2j.cn 版权所有-->
<!-- 本教程仅用于学习使用，切勿用于非法用途，由此引起一切后果与本站无关-->
<!-- 供购买者学习，请勿私自传播，否则自行承担相关法律责任-->

<div th:fragment="html"> 
	<script>
		$(function(){
			var vid = getUrlParms("vid");
			var bid = getUrlParms("bid");
	        var data4Vue = {
	        		venue:'',
				showReviews:false,
				pagination:{},
					reviews:[],
	        		bean:{},
				msg:'评论成功'
	        };
	        //ViewModel
	        var vue = new Vue({
	            el: '#workingArea',
	            data: data4Vue,
	            mounted:function(){ //mounted　表示这个 Vue 对象加载成功了
	            	// this.load();
	            	this.getVenue();
	            	this.list(0);
	            },        
	            methods: {
	            	load:function(){
	            		//?????????????????
						//var url = "payed/" + bid;
						axios.get(url).then(function (response) {
							console.log(response.data);
							if (response.data.status == 200) {
								vue.msg = "评论成功！请等待管理员审核！"
							}else{
								vue.msg = response.data.msg;
								console.log(this.msg);
								$("#myModal").modal('show');
								setTimeout(function () {
									$("#myModal").modal('hide');
									location.href="bought";
								}, 2000);
							}
					})
					},
					getVenue:function(){
						var url = "venues/"+vid;
						axios.get(url).then(function(response) {
								vue.venue = response.data.data;
								console.log(response.data.data);
						})
					},
						list:function(start){
	                    var url =  "venues/"+vid+"/messages/show?start="+start;
	                    axios.get(url).then(function(response) {
	                    	var result = response.data;
	                    	console.log(result);
							vue.pagination = response.data.data;
							vue.reviews = response.data.data.content;

							// vue.$nextTick(function(){
	        	            // 	linkDefaultActions();
	                        // })
	                    });
	            	},
					jump: function(page){
						jump(page,vue); //定义在adminHeader.html 中
					},
					jumpByNumber: function(start){
						jumpByNumber(start,vue);
					},
	            	doreview:function(){
	                    var url =  "messages/"+vid+"?bid="+bid;
						console.log(vue.bean);

						axios.post(url,this.bean).then(function(response) {
	                    	var result = response.data;
	                    	console.log(result.data);
							$("#myModal").modal('show');
							setTimeout(function () {
								$("#myModal").modal('hide');
								vue.showReviews = true;
								vue.list(0);
							}, 2000);
	                    	// vue.showReviews = true;
	                    	// vue.list(0);
	                    });
	            	}
	            }
	        });       			
		})	
	</script>

	<div class="reviewDiv">
		<div class="reviewProductInfoDiv">
			<div class="reviewProductInfoImg"><img v-if="null!=venue.firstVenueImage" width="400px" height="400px" :src="'img/venueImage/'+venue.id+'/'+venue.firstVenueImage.id+'.jpg'"></div>
			<div class="reviewProductInfoRightDiv">
				<div class="reviewProductInfoRightText">
					{{venue.name}}
				</div>
				<table class="reviewProductInfoTable">
					<tr>
						<td width="75px">价格:</td>
						<td><span class="reviewProductInfoTablePrice">￥{{venue.price|formatMoneyFilter}}</span> 元 </td>
					</tr>
				</table>

			</div>
			<div style="clear:both"></div>
		</div>

		<div class="reviewStasticsDiv">
			<div class="reviewStasticsLeft">
				<div class="reviewStasticsLeftTop"></div>
				<div class="reviewStasticsLeftContent">累计评价 <span class="reviewStasticsNumber"> {{venue.reviewCount}}</span></div>
				<div class="reviewStasticsLeftFoot"></div>
			</div>
			<div class="reviewStasticsRight">
				<div class="reviewStasticsRightEmpty"></div>
				<div class="reviewStasticsFoot"></div>
			</div>
		</div>

			<div v-show="showReviews" class="reviewDivlistReviews">
				<div v-for="r in reviews" class="reviewDivlistReviewsEach">
					<div class="reviewDate">{{r.createDate}}</div>
					<div class="reviewContent">{{r.content}}</div>
					<div class="reviewUserInfo pull-right">{{r.user.anonymousName}}<span class="reviewUserInfoAnonymous">(匿名)</span></div>
				</div>
				<div th:replace="include/admin/adminPage::html" ></div>

			</div>

			<div v-show="!showReviews" class="makeReviewDiv">
					<table class="makeReviewTable">
						<tr>
							<td class="makeReviewTableFirstTD">留言</td>
							<td><textarea name="content" v-model.trim="bean.content"
										  placeholder="请输入留言内容"></textarea></td>
						</tr>
						<tr class="submitTR">
							<td colspan="2" align="center">
								<a href="#nowhere"  @click="doreview" class="btn btn-success">提交</a>
							</td>
						</tr>
					</table>
			</div>

	</div>
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button data-dismiss="modal" class="close" type="button"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
					<h4 class="modal-title">{{msg}}</h4>
				</div>
				<div class="modal-footer">
					<button data-dismiss="modal" class="btn btn-default" type="button">关闭</button>
				</div>
			</div><!-- /.modal-content -->
		</div><!-- /.modal-dialog -->
	</div>
</div>
