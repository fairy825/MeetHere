<!-- 模仿天猫整站springboot 教程 为how2j.cn 版权所有-->
<!-- 本教程仅用于学习使用，切勿用于非法用途，由此引起一切后果与本站无关-->
<!-- 供购买者学习，请勿私自传播，否则自行承担相关法律责任-->

<div th:fragment="html">
    <script>
        $(function(){
            var id = getUrlParms("id");
            var data4Vue = {
                uri:'showVenue',
                bean:{},
                tss:[],
                ts:{},
                date:0,
                messages:[],
                pagination:{},
                now:'',
                booking:'',
                tid:'',
                remark:'',
                // user:{name:'', password:''}
            };
            //ViewModel
            var vue = new Vue({
                el: '#workingArea',
                data: data4Vue,
                mounted:function(){ //mounted　表示这个 Vue 对象加载成功了
                    // linkDefaultActions();
                    this.list(0);
                    this.getTimeSlot(this.date);
                    this.load();
                },
                methods: {
                    load:function() {
                        var url = this.uri + "/" + id;
                        axios.get(url).then(function (response) {
                            var result = response.data;
                            vue.bean = result.data;
                            console.log(vue.bean);
                            vue.$nextTick(function () {
                                imgAndInfoPageRegisterListeners(vue);
                                dateListener(vue);
                                remarkListener(vue);
                            })
                        });
                    },
                    list:function(start) {
                        var now = new Date().getHours();
                        this.now = now;
                        var url2 =  "venues/"+id+"/messages/show?start="+start;
                        axios.get(url2).then(function(response) {
                            console.log(response.data);

                            vue.pagination = response.data.data;
                            vue.messages = response.data.data.content;
                        });
                    },
                    getTimeSlot:function(date){
                        var url =  "venues/"+id+"/timeSlots?date="+date;
                        axios.get(url).then(function(response) {
                            console.log(response.data);
                            vue.tss = response.data.data;
                            console.log(vue.tss);
                        });
                    },
                    buy: function(tid,remark){
                        var url =  "buy/"+tid+"?remark="+remark;
                        axios.get(url).then(function(response) {
                            console.log(response.data);
                            vue.booking = response.data.data;
                            console.log(vue.booking);
                            $("#myModal").modal('show');
                            vue.getTimeSlot(vue.date);
                        });
                        $("#remarkEnterModal").modal('hide');

                    },
                    jump: function(page){
                        jump(page,vue); //定义在adminHeader.html 中
                    },
                    jumpByNumber: function(start){
                        jumpByNumber(start,vue);
                    }
                }
            });


        });
    </script>

    <div class="productPageDiv">
        <div th:replace="include/fore/venue/imgAndInfo::html" ></div>
        <div th:replace="include/fore/venue/makeOrder::html" ></div>
        <div th:replace="include/fore/venue/review::html" ></div>
    </div>
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button data-dismiss="modal" class="close" type="button"><span aria-hidden="true">×</span><span class="sr-only">Close</span></button>
                    <h4 class="modal-title">预约成功！</h4>
                </div>
                <div class="modal-body">
                    <p>预约成功！请耐心等待管理员审核！</p>
                </div>
                <div class="modal-footer">
                    <button data-dismiss="modal" class="btn btn-default" type="button">关闭</button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div>

    <div style="height:200px"></div>
</div>
